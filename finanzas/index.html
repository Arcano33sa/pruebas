<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Finanzas – Suite A33</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
</head>
<body class="fin-body">
  <div class="fin-app">

    <!-- ENCABEZADO CON LOGO A33 -->
    <header class="fin-header">
      <div class="fin-header-left">
        <div class="fin-logo-wrapper">
          <!-- Logo Arcano 33 (misma ruta que el menú principal) -->
          <img src="../LOGOTIPO A33.png" alt="Arcano 33" class="fin-logo-img">
        </div>
        <div class="fin-title-block">
          <h1>Suite A33</h1>
          <p>Finanzas · Contabilidad básica de Arcano 33</p>
        </div>
      </div>

      <nav class="fin-main-nav">
        <div class="nav-group">
          <span class="nav-group-label">Suite A33</span>
          <a href="../index.html">Calculadora</a>
          <a href="../inventario/index.html">Inventario</a>
          <a href="../pos/index.html">A33 POS · Eventos</a>
          <a href="../pedidos/index.html">Planificación de Pedidos</a>
          <a href="../analitica/index.html">Analítica de Ventas</a>
          <a href="../lotes/index.html">Control de Lotes</a>
        </div>

        <div class="nav-group">
          <span class="nav-group-label">Finanzas</span>
          <button type="button" class="fin-tab-btn active" data-view="tablero">Tablero Finanzas</button>
          <button type="button" class="fin-tab-btn" data-view="diario">Diario y Ajustes</button>
          <button type="button" class="fin-tab-btn" data-view="estados">Estados Financieros</button>
        </div>
      </nav>
    </header>

    <main class="fin-main">

      <!-- TABLERO FINANZAS -->
      <section id="view-tablero" class="fin-view active">
        <header class="fin-section-header">
          <h2>Tablero Finanzas</h2>
          <p>Resumen mensual de ingresos, costos, gastos y resultado. Puedes filtrar por evento.</p>
        </header>

        <div class="fin-filters-row">
          <label>
            Mes
            <select id="tab-mes"></select>
          </label>
          <label>
            Año
            <select id="tab-anio"></select>
          </label>
          <label>
            Evento
            <select id="tab-evento"></select>
          </label>
        </div>

        <div class="fin-cards-grid">
          <article class="fin-card">
            <h3>Ingresos (4xxx)</h3>
            <p id="tab-ingresos" class="fin-card-number">C$ 0.00</p>
          </article>

          <article class="fin-card">
            <h3>Costos de venta (5xxx)</h3>
            <p id="tab-costos" class="fin-card-number">C$ 0.00</p>
          </article>

          <article class="fin-card">
            <h3>Gastos de operación (6xxx)</h3>
            <p id="tab-gastos" class="fin-card-number">C$ 0.00</p>
          </article>

          <article class="fin-card fin-card-strong">
            <h3>Resultado del periodo</h3>
            <p id="tab-resultado" class="fin-card-number">C$ 0.00</p>
          </article>

          <article class="fin-card">
            <h3>Saldo Caja (1100 + 1110)</h3>
            <p id="tab-caja" class="fin-card-number">C$ 0.00</p>
          </article>

          <article class="fin-card">
            <h3>Saldo Banco (1200)</h3>
            <p id="tab-banco" class="fin-card-number">C$ 0.00</p>
          </article>
        </div>
      </section>

      <!-- DIARIO Y AJUSTES -->
      <section id="view-diario" class="fin-view">
        <header class="fin-section-header">
          <h2>Diario y Ajustes</h2>
          <p>Registra ingresos, egresos y ajustes manuales. Por detrás se generan asientos DEBE/HABER.</p>
        </header>

        <!-- Botón exportar Diario a Excel -->
        <div class="fin-actions-row">
          <button type="button" id="btn-export-diario" class="btn-primary">
            Exportar Diario a Excel
          </button>
        </div>

        <div class="fin-filters-row fin-filters-row--compact">
          <label>
            Tipo
            <select id="filtro-tipo">
              <option value="todos">Todos</option>
              <option value="ingreso">Ingresos</option>
              <option value="egreso">Egresos</option>
              <option value="ajuste">Ajustes</option>
            </select>
          </label>

          <label>
            Evento
            <select id="filtro-evento-diario"></select>
          </label>

          <label>
            Origen
            <select id="filtro-origen">
              <option value="todos">Todos</option>
              <option value="Manual">Manual</option>
              <option value="POS">POS</option>
            </select>
          </label>
        </div>

        <form id="form-movimiento" class="fin-form">
          <div class="fin-form-row">
            <label>
              Fecha
              <input type="date" id="mov-fecha">
            </label>

            <label>
              Tipo de movimiento
              <select id="mov-tipo">
                <option value="ingreso">Ingreso</option>
                <option value="egreso">Egreso</option>
                <option value="ajuste">Ajuste</option>
              </select>
            </label>

            <label>
              Medio
              <select id="mov-medio">
                <option value="caja">Caja</option>
                <option value="banco">Banco</option>
              </select>
            </label>

            <label>
              Monto
              <input type="number" id="mov-monto" step="0.01" min="0">
            </label>
          </div>

          <div class="fin-form-row">
            <label class="fin-form-grow">
              Cuenta principal
              <select id="mov-cuenta"></select>
            </label>

            <label class="fin-form-grow">
              Evento (texto opcional)
              <input type="text" id="mov-evento" placeholder="Ej: General, NE2025, Boda X, etc.">
            </label>
          </div>

          <div class="fin-form-row">
            <label class="fin-form-grow">
              Descripción
              <input type="text" id="mov-descripcion" placeholder="Descripción del movimiento">
            </label>

            <button type="button" id="mov-guardar" class="btn-primary">
              Guardar movimiento
            </button>
          </div>

          <p class="fin-help">
            En Fase 3A el asiento sigue siendo de dos líneas automáticas:
            <br>
            <strong>Ingreso:</strong> DEBE Caja/Banco · HABER Cuenta de ingreso seleccionada.<br>
            <strong>Egreso:</strong> DEBE Cuenta de gasto/costo · HABER Caja/Banco.<br>
            <strong>Ajuste simple:</strong> Caja/Banco contra la cuenta seleccionada.
          </p>
        </form>

        <div class="fin-table-wrapper">
          <table class="fin-table">
            <thead>
              <tr>
                <th>Fecha</th>
                <th>Descripción</th>
                <th>Tipo</th>
                <th>Evento</th>
                <th>Origen</th>
                <th>Debe</th>
                <th>Haber</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="diario-tbody"></tbody>
          </table>
        </div>
      </section>

      <!-- ESTADOS FINANCIEROS -->
      <section id="view-estados" class="fin-view">
        <header class="fin-section-header">
          <h2>Estados Financieros</h2>
          <p>Estado de Resultados y Balance General usando los asientos de Finanzas.</p>
        </header>

        <div class="fin-subtabs">
          <button type="button" class="fin-subtab-btn active" data-subview="er">Estado de Resultados</button>
          <button type="button" class="fin-subtab-btn" data-subview="bg">Balance General</button>
        </div>

        <!-- Estado de Resultados -->
        <section id="sub-er" class="fin-subview active">
          <div class="fin-filters-row">
            <label>
              Modo de periodo
              <select id="er-modo">
                <option value="mes">Por mes</option>
                <option value="rango">Por rango de fechas</option>
              </select>
            </label>

            <div id="er-filtros-mes" class="fin-inline-group">
              <label>
                Mes
                <select id="er-mes"></select>
              </label>
              <label>
                Año
                <select id="er-anio"></select>
              </label>
            </div>

            <div id="er-filtros-rango" class="fin-inline-group hidden">
              <label>
                Desde
                <input type="date" id="er-desde">
              </label>
              <label>
                Hasta
                <input type="date" id="er-hasta">
              </label>
            </div>

            <label>
              Evento
              <select id="er-evento"></select>
            </label>
          </div>

          <!-- Botones de exportación ER / Rentabilidad / Comparativo / Flujo -->
          <div class="fin-actions-row">
            <button type="button" id="btn-export-er" class="btn-primary">
              Exportar ER a Excel
            </button>
            <button type="button" id="btn-export-rentab" class="btn-primary">
              Exportar Rentabilidad a Excel
            </button>
            <button type="button" id="btn-export-comp-eventos" class="btn-primary">
              Exportar Comparativo de eventos
            </button>
            <button type="button" id="btn-export-flujo" class="btn-primary">
              Exportar Flujo de Caja
            </button>
          </div>

          <div class="fin-cards-grid fin-cards-grid--er">
            <article class="fin-card">
              <h3>Ingresos (4xxx)</h3>
              <p id="er-ingresos" class="fin-card-number">C$ 0.00</p>
            </article>

            <article class="fin-card">
              <h3>Costos de venta (5xxx)</h3>
              <p id="er-costos" class="fin-card-number">C$ 0.00</p>
            </article>

            <article class="fin-card">
              <h3>Gastos de operación (6xxx)</h3>
              <p id="er-gastos" class="fin-card-number">C$ 0.00</p>
            </article>

            <article class="fin-card fin-card-strong">
              <h3>Utilidad bruta</h3>
              <p id="er-bruta" class="fin-card-number">C$ 0.00</p>
            </article>

            <article class="fin-card fin-card-strong">
              <h3>Utilidad neta</h3>
              <p id="er-neta" class="fin-card-number">C$ 0.00</p>
            </article>
          </div>

          <p class="fin-help">
            Nota: en Fase 3A los costos (5xxx) se pueden registrar manualmente.
            En Fase 3B los costos de venta se generarán en automático desde el POS según presentaciones de Arcano 33.
          </p>
        </section>

        <!-- Balance General -->
        <section id="sub-bg" class="fin-subview">
          <div class="fin-filters-row">
            <label>
              Fecha de corte
              <input type="date" id="bg-fecha">
            </label>
          </div>

          <!-- Botón exportar Balance a Excel -->
          <div class="fin-actions-row">
            <button type="button" id="btn-export-bg" class="btn-primary">
              Exportar Balance a Excel
            </button>
          </div>

          <div class="fin-table-wrapper">
            <table class="fin-table">
              <thead>
                <tr>
                  <th>Grupo</th>
                  <th>Saldo</th>
                </tr>
              </thead>
              <tbody id="bg-tbody">
                <tr>
                  <td>Activos (1xxx)</td>
                  <td id="bg-activos" class="num">C$ 0.00</td>
                </tr>
                <tr>
                  <td>Pasivos (2xxx)</td>
                  <td id="bg-pasivos" class="num">C$ 0.00</td>
                </tr>
                <tr>
                  <td>Patrimonio (3xxx)</td>
                  <td id="bg-patrimonio" class="num">C$ 0.00</td>
                </tr>
                <tr class="fin-row-strong">
                  <td>Activos – Pasivos – Patrimonio</td>
                  <td id="bg-cuadre" class="num">C$ 0.00</td>
                </tr>
              </tbody>
            </table>
          </div>

          <p class="fin-help">
            Idealmente el Balance cuadra (Activos = Pasivos + Patrimonio).
            En esta Fase 3A solo se usan las cuentas 1xxx, 2xxx y 3xxx que entren en los asientos.
          </p>
        </section>
      </section>
    </main>

    <!-- Toast -->
    <div id="toast" class="fin-toast"></div>

    <!-- Modal detalle de asiento -->
    <div id="detalle-modal" class="fin-modal">
      <div class="fin-modal-content">
        <header class="fin-modal-header">
          <h3>Detalle de asiento</h3>
          <button type="button" id="detalle-cerrar" class="btn-close">×</button>
        </header>
        <div class="fin-modal-body">
          <div id="detalle-meta" class="fin-detalle-meta"></div>
          <div class="fin-table-wrapper">
            <table class="fin-table">
              <thead>
                <tr>
                  <th>Cuenta</th>
                  <th>Nombre</th>
                  <th>Debe</th>
                  <th>Haber</th>
                </tr>
              </thead>
              <tbody id="detalle-tbody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

  </div>

  <script src="script.js"></script>
</body>
</html>
