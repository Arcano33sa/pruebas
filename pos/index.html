<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Suite A33 · POS</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="icon" href="../assets/favicon.png" />
  <meta name="theme-color" content="#0b0b0b" />
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo">A33</div>
      <div class="meta">
        <div class="title">POS · Eventos</div>
        <div class="subtitle" id="active-event-label">Sin evento activo</div>
      </div>
    </div>
    <div class="top-actions">
      <button class="btn btn-ghost" id="btn-open-events">Eventos</button>
      <button class="btn btn-gold" id="btn-export-event">Exportar (Excel)</button>
    </div>
  </header>

  <main class="app">
    <section class="card" id="card-vender">
      <div class="card-head">
        <h2>Vender</h2>
        <div class="pill" id="pill-event-status">—</div>
      </div>

      <div class="grid-2">
        <div class="field">
          <label>Producto</label>
          <select id="sale-product"></select>
        </div>
        <div class="field">
          <label>Stock evento</label>
          <div class="readonly" id="sale-stock-label">—</div>
        </div>

        <div class="field">
          <label>Cantidad</label>
          <input type="number" id="sale-qty" min="1" step="1" value="1" />
        </div>
        <div class="field">
          <label>Descuento (C$)</label>
          <input type="number" id="sale-discount" min="0" step="0.01" value="0" />
        </div>

        <div class="field">
          <label>Pago</label>
          <select id="sale-payment">
            <option value="efectivo">Efectivo</option>
            <option value="transferencia">Transferencia</option>
            <option value="credito">Crédito</option>
          </select>
        </div>
        <div class="field" id="bank-field" style="display:none">
          <label>Banco</label>
          <select id="sale-bank"></select>
        </div>

        <div class="field" id="customer-field" style="display:none">
          <label>Cliente</label>
          <input type="text" id="sale-customer" placeholder="Nombre del cliente" />
        </div>

        <div class="field">
          <label>Cortesía</label>
          <select id="sale-courtesy">
            <option value="no">No</option>
            <option value="si">Sí</option>
          </select>
        </div>

        <div class="field" id="courtesy-to-field" style="display:none">
          <label>Cortesía a</label>
          <input type="text" id="sale-courtesy-to" placeholder="Nombre o referencia" />
        </div>

        <div class="field" style="grid-column:1/-1">
          <label>Notas</label>
          <input type="text" id="sale-notes" placeholder="Opcional: detalle, referencia, etc." />
        </div>

        <div class="field">
          <label>Total (C$)</label>
          <input type="text" id="sale-total" readonly />
        </div>
        <div class="field sticky-total">
          <label>Total</label>
          <div class="sticky" id="sticky-total">0.00</div>
        </div>
      </div>

      <div class="actions">
        <button class="btn btn-red" id="sale-add">Agregar venta</button>
        <button class="btn btn-ghost" id="sale-reset">Limpiar</button>
      </div>

      <div class="divider"></div>

      <div class="card-subhead">
        <h3>Ventas del día</h3>
        <div class="muted" id="day-label">—</div>
      </div>

      <div class="table-wrap">
        <table class="tbl" id="tbl-day">
          <thead>
            <tr>
              <th>Hora</th>
              <th>Producto</th>
              <th>Cant.</th>
              <th>Pago</th>
              <th>Total</th>
              <th class="right">Acción</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <section class="card" id="card-inventario" style="display:none">
      <div class="card-head">
        <h2>Inventario (evento)</h2>
        <div class="muted">Stock disponible para vender</div>
      </div>

      <div class="inv-actions">
        <button class="btn btn-gold" id="btn-add-from-lote">Agregar desde lote</button>
        <button class="btn btn-red" id="btn-new-item">✨ Nuevo ítem</button>
      </div>

      <div class="lotes-block" id="lotes-block">
        <div class="lotes-block-head">
          <div>
            <b>Lotes cargados en este evento</b>
            <span class="badge" id="badge-lotes-count">0</span>
          </div>
          <small class="muted">Se agrupan por lote, no por línea.</small>
        </div>
        <div class="table-wrap" style="margin-top:10px">
          <table class="tbl" id="tbl-lotes-evento">
            <thead>
              <tr>
                <th>Lote</th>
                <th>Fecha</th>
                <th>P</th>
                <th>M</th>
                <th>D</th>
                <th>L</th>
                <th>G</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div class="divider"></div>

      <div class="table-wrap">
        <table class="tbl" id="tbl-inv">
          <thead>
            <tr>
              <th>Producto</th>
              <th>Stock</th>
              <th class="right">Acción</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <section class="card" id="card-eventos" style="display:none">
      <div class="card-head">
        <h2>Eventos</h2>
        <div class="muted">Gestiona, activa o cierra eventos</div>
      </div>

      <div class="grid-2">
        <div class="field">
          <label>Evento Maestro</label>
          <select id="event-master"></select>
        </div>
        <div class="field">
          <label>Nombre del evento</label>
          <input id="event-name" type="text" placeholder="Ej. Feria de Emprendedores" />
        </div>
      </div>

      <div class="actions">
        <button class="btn btn-gold" id="event-create">Crear evento</button>
        <button class="btn btn-ghost" id="event-refresh">Recargar</button>
      </div>

      <div class="divider"></div>

      <div class="table-wrap">
        <table class="tbl" id="tbl-events">
          <thead>
            <tr>
              <th>Evento</th>
              <th>Estado</th>
              <th>Creado</th>
              <th class="right">Acción</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <section class="card" id="card-caja" style="display:none">
      <div class="card-head">
        <h2>Caja Chica</h2>
        <div class="muted">Arqueo, movimientos, cierres e historial</div>
      </div>

      <div class="row" style="gap:10px; align-items:flex-end; flex-wrap:wrap">
        <div class="field" style="min-width:170px">
          <label>Día</label>
          <input id="pc-day" type="date" />
        </div>

        <div class="field" style="min-width:240px">
          <label>Histórico (solo lectura)</label>
          <select id="pc-history-select"></select>
          <small class="muted" id="pc-history-hint"></small>
        </div>

        <div class="field" style="flex:1; min-width:200px">
          <label>&nbsp;</label>
          <div id="pc-history-banner" class="banner" style="display:none"></div>
        </div>

        <div class="field" style="min-width:220px; display:flex; gap:8px">
          <button class="btn btn-ghost" id="pc-history-back" style="display:none">Volver al día operativo</button>
          <button class="btn btn-gold" id="pc-history-use" style="display:none">Usar este cierre como inicio</button>
        </div>
      </div>

      <div class="divider"></div>

      <div class="grid-2">
        <div>
          <h3>Saldo inicial C$</h3>
          <div class="table-wrap">
            <table class="tbl" id="pc-table-nio">
              <thead>
                <tr><th>Denom.</th><th>Cant.</th><th>Sub</th></tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <div>
          <h3>Saldo inicial US$</h3>
          <div class="table-wrap">
            <table class="tbl" id="pc-table-usd">
              <thead>
                <tr><th>Denom.</th><th>Cant.</th><th>Sub</th></tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="actions">
        <button class="btn btn-gold" id="pc-btn-save-initial">Guardar saldo inicial</button>
        <button class="btn btn-ghost" id="pc-btn-clear-initial">Limpiar</button>
      </div>

      <div class="divider"></div>

      <h3>Movimientos</h3>
      <div class="row" style="gap:10px; flex-wrap:wrap">
        <div class="field" style="min-width:160px">
          <label>Tipo</label>
          <select id="pc-mov-type">
            <option value="entrada">Entrada</option>
            <option value="salida">Salida</option>
          </select>
        </div>
        <div class="field" style="min-width:160px">
          <label>Moneda</label>
          <select id="pc-mov-currency">
            <option value="NIO">C$</option>
            <option value="USD">US$</option>
          </select>
        </div>
        <div class="field" style="min-width:140px">
          <label>Monto</label>
          <input id="pc-mov-amount" type="number" step="0.01" inputmode="decimal" />
        </div>
        <div class="field" style="flex:1; min-width:240px">
          <label>Descripción</label>
          <input id="pc-mov-desc" type="text" placeholder="Ej. Cambio, compra, etc." />
        </div>
        <div class="field" style="min-width:150px">
          <label>&nbsp;</label>
          <button class="btn btn-red" id="pc-mov-add">Agregar</button>
        </div>
      </div>

      <div class="table-wrap">
        <table class="tbl" id="pc-mov-table">
          <thead>
            <tr>
              <th>Hora</th>
              <th>Tipo</th>
              <th>Moneda</th>
              <th>Monto</th>
              <th>Descripción</th>
              <th class="right">Acción</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div class="divider"></div>

      <div class="grid-2">
        <div>
          <h3>Arqueo final C$</h3>
          <div class="table-wrap">
            <table class="tbl" id="pc-table-fnio">
              <thead>
                <tr><th>Denom.</th><th>Cant.</th><th>Sub</th></tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <div>
          <h3>Arqueo final US$</h3>
          <div class="table-wrap">
            <table class="tbl" id="pc-table-fusd">
              <thead>
                <tr><th>Denom.</th><th>Cant.</th><th>Sub</th></tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="actions">
        <button class="btn btn-gold" id="pc-btn-save-final">Guardar arqueo final</button>
        <button class="btn btn-ghost" id="pc-btn-clear-final">Limpiar</button>
      </div>

      <div class="divider"></div>

      <div class="grid-2">
        <div class="field">
          <label>T/C del día (C$ por 1 US$)</label>
          <input id="pc-fx-rate" type="number" step="0.01" inputmode="decimal" placeholder="Ej. 36.50" />
          <small class="muted">Obligatorio si hubo USD en Caja Chica.</small>
        </div>
        <div class="field" style="display:flex; align-items:flex-end; gap:8px">
          <button class="btn btn-gold" id="pc-btn-save-fx">Guardar T/C</button>
        </div>
      </div>

      <div class="divider"></div>

      <h3>Cierre definitivo del día</h3>
      <div class="muted" id="pc-close-status"></div>
      <div id="pc-close-blocker" class="blocker" style="display:none"></div>

      <div class="divider"></div>

      <h4>Ajuste de arqueo (si hay diferencia)</h4>

      <div class="grid-2">
        <div class="card-lite">
          <div class="muted" style="margin-bottom:6px">C$</div>
          <div class="pc-adj-grid">
            <input id="pc-adj-nio-amount" class="pc-adj-amount" type="number" inputmode="decimal" step="0.01" placeholder="Monto del ajuste (obligatorio)">
            <input id="pc-adj-nio-concept" class="pc-adj-concept" type="text" placeholder="Concepto (obligatorio)">
            <input id="pc-adj-nio-notes" class="pc-adj-notes" type="text" placeholder="Notas (opcional)">
          </div>
          <div class="actions" style="margin-top:8px">
            <button class="btn btn-red" id="pc-btn-adj-nio">Registrar ajuste C$</button>
            <button class="btn btn-ghost" id="pc-btn-clear-adj-nio">Quitar ajuste</button>
          </div>
          <small class="muted" id="pc-adj-nio-status"></small>
        </div>

        <div class="card-lite">
          <div class="muted" style="margin-bottom:6px">US$</div>
          <div class="pc-adj-grid">
            <input id="pc-adj-usd-amount" class="pc-adj-amount" type="number" inputmode="decimal" step="0.01" placeholder="Monto del ajuste (obligatorio)">
            <input id="pc-adj-usd-concept" class="pc-adj-concept" type="text" placeholder="Concepto (obligatorio)">
            <input id="pc-adj-usd-notes" class="pc-adj-notes" type="text" placeholder="Notas (opcional)">
          </div>
          <div class="actions" style="margin-top:8px">
            <button class="btn btn-red" id="pc-btn-adj-usd">Registrar ajuste US$</button>
            <button class="btn btn-ghost" id="pc-btn-clear-adj-usd">Quitar ajuste</button>
          </div>
          <small class="muted" id="pc-adj-usd-status"></small>
        </div>
      </div>

      <div class="pc-adj-records" id="pc-adj-records" style="display:none"></div>

      <div class="actions" style="margin-top:10px">
        <button class="btn btn-gold" id="pc-btn-close-day">Cierre definitivo del día</button>
        <button class="btn btn-ghost" id="pc-btn-reopen-day" style="display:none">Reabrir día</button>
      </div>
    </section>
  </main>

  <nav class="bottom-nav">
    <button class="tab active" data-tab="vender">Vender</button>
    <button class="tab" data-tab="inventario">Inventario</button>
    <button class="tab" data-tab="eventos">Eventos</button>
    <button class="tab" data-tab="caja">Caja Chica</button>
  </nav>

  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="app.js"></script>
</body>
</html>
